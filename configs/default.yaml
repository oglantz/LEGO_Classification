# Default configuration for LEGO Piece Detection System

segmentation:
  backend: "sam"  # Options: "sam", "fastsam"
  model_type: "vit_b"  # For SAM: "vit_b" | "vit_l" | "vit_h" ; For FastSAM: "FastSAM-x" | "FastSAM-s"
  model_path: "models/segmentation/sam_vit_b_01ec64.pth" # Absolute path recommended on Windows
  points_per_side: 32  # Number of points per side for automatic mask generation
  pred_iou_thresh: 0.88  # IoU threshold for filtering masks (0-1, higher = stricter)
  stability_score_thresh: 0.95  # Stability score threshold (0-1, higher = stricter)
  min_mask_area: 100  # Minimum mask area in pixels
  overlap_threshold: 0.7  # IoU threshold for merging overlapping masks

classification:
  model_name: "resnet50"  # Model architecture
  num_classes: 1000  # Number of LEGO part classes (top N most common)
  top_k: 5  # Number of top predictions to return
  confidence_threshold: 0.3  # Minimum confidence threshold
  checkpoint_path: null  # Path to trained model checkpoint (null = use dummy/pretrained)

postprocessing:
  aspect_ratio_tolerance: 0.3  # Tolerance for aspect ratio matching
  area_tolerance: 0.5  # Tolerance for area matching
  stud_count_weight: 0.2  # Weight for stud count heuristic

data:
  dataset_name: "pvrancx/legobricks"  # HuggingFace dataset name
  image_size: 224  # Input image size for classification
  batch_size: 768  # Batch size for training
  splits_dir: "data/splits/legobricks" # Directory containing pre-computed splits (local)
  # splits_dir: "/content/gdrive/MyDrive/data/splits/legobricks/legobricks" # Directory containing pre-computed splits (Google Drive)
  num_workers: 16  # Dataloader workers (increase on A100/Pro)
  prefetch_factor: 4  # Batches prefetched per worker (effective if num_workers > 0)

training:
  epochs: 50  # Number of training epochs
  learning_rate: 0.001  # Initial learning rate
  weight_decay: 0.0001  # Weight decay for optimizer
  mixed_precision: true  # Use mixed precision training (FP16)
  allow_tf32: true  # Enable TF32 on A100 (faster matmuls/convs)
  use_bf16: true  # Prefer BF16 autocast on A100 (instead of FP16)
  use_channels_last: true  # Use channels_last memory format for conv nets
  compile_model: false  # Use torch.compile for potential speedups (adds warmup time)
  tqdm_mininterval: 1.0  # Seconds between tqdm refreshes
  tqdm_miniters: 10  # Minimum iterations between refreshes
  checkpoint_dir: "models/classification"  # Directory for checkpoints
  log_dir: "logs"  # Directory for TensorBoard logs
  early_stopping_patience: 10  # Patience for early stopping

visualization:
  font_size: 16  # Font size for labels
  mask_alpha: 0.4  # Transparency for mask overlay (0-1)
  show_boxes: true  # Show bounding boxes
  show_labels: true  # Show labels
  show_confidences: true  # Show confidence scores

device:
  use_cuda: true  # Prefer CUDA if available
  seed: 42  # Random seed for reproducibility

